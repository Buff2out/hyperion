

–ø—Ä–∏–º–µ—Ä –∫–æ–¥–∞, –±–ª–∏–∑–∫–æ–≥–æ –∫ —ç—Ç–∞–ª–æ–Ω–Ω–æ–º—É:
```rust
pub fn nth(n: u32) -> u32 {
    let mut num = 1;
    for _ in 0..=n {
        loop {
            num += 1;
            if miller_rabin(num as u64) {
                break;
            }
        }
    }
    num
}

fn miller_rabin(n: u64) -> bool {
    const HINT: &[u64] = &[2];

    // we have a strict upper bound, so we can just use the witness
    // table of Pomerance, Selfridge & Wagstaff and Jeaschke to be as
    // efficient as possible, without having to fall back to
    // randomness. Additional limits from Feitsma and Galway complete
    // the entire range of `u64`. See also:
    // https://en.wikipedia.org/wiki/Miller%E2%80%93Rabin_primality_test#Testing_against_small_sets_of_bases
    const WITNESSES: &[(u64, &[u64])] = &[
        (2_046, HINT),
        (1_373_652, &[2, 3]),
        (9_080_190, &[31, 73]),
        (25_326_000, &[2, 3, 5]),
        (4_759_123_140, &[2, 7, 61]),
        (1_112_004_669_632, &[2, 13, 23, 1662803]),
        (2_152_302_898_746, &[2, 3, 5, 7, 11]),
        (3_474_749_660_382, &[2, 3, 5, 7, 11, 13]),
        (341_550_071_728_320, &[2, 3, 5, 7, 11, 13, 17]),
        (3_825_123_056_546_413_050, &[2, 3, 5, 7, 11, 13, 17, 19, 23]),
        (std::u64::MAX, &[2, 3, 5, 7, 11, 13, 17, 19, 23, 29, 31, 37]),
    ];

    if n % 2 == 0 {
        return n == 2;
    }
    if n == 1 {
        return false;
    }

    let mut d = n - 1;
    let mut s = 0;
    while d % 2 == 0 {
        d /= 2;
        s += 1
    }

    let witnesses = WITNESSES
        .iter()
        .find(|&&(hi, _)| hi >= n)
        .map(|&(_, wtnss)| wtnss)
        .unwrap();
    'next_witness: for &a in witnesses.iter() {
        let mut power = mod_exp(a, d, n);
        assert!(power < n);
        if power == 1 || power == n - 1 {
            continue 'next_witness;
        }

        for _r in 0..s {
            power = mod_sqr(power, n);
            assert!(power < n);
            if power == 1 {
                return false;
            }
            if power == n - 1 {
                continue 'next_witness;
            }
        }
        return false;
    }

    true
}

fn mod_mul_(a: u64, b: u64, m: u64) -> u64 {
    (u128::from(a) * u128::from(b) % u128::from(m)) as u64
}

fn mod_mul(a: u64, b: u64, m: u64) -> u64 {
    match a.checked_mul(b) {
        Some(r) => {
            if r >= m {
                r % m
            } else {
                r
            }
        }
        None => mod_mul_(a, b, m),
    }
}

fn mod_sqr(a: u64, m: u64) -> u64 {
    if a < (1 << 32) {
        let r = a * a;
        if r >= m { r % m } else { r }
    } else {
        mod_mul_(a, a, m)
    }
}

fn mod_exp(mut x: u64, mut d: u64, n: u64) -> u64 {
    let mut ret: u64 = 1;
    while d != 0 {
        if d % 2 == 1 {
            ret = mod_mul(ret, x, n)
        }
        d /= 2;
        x = mod_sqr(x, n);
    }
    ret
}

```

## –ß—Ç–æ —Ç–∞–∫–æ–µ Miller-Rabin (—Å –Ω—É–ª—è, –º–µ—Ç–∞—Ñ–æ—Ä–∞ "–°—É–¥—å—è –∏ –õ–∂–µ—Ü—ã")

–ü—Ä–µ–¥—Å—Ç–∞–≤—å –ø—Ä–æ—Å—Ç–æ–µ —á–∏—Å–ª–æ –∫–∞–∫ **—á–µ—Å—Ç–Ω–æ–≥–æ —Å—É–¥—å—é**, –∞ —Å–æ—Å—Ç–∞–≤–Ω–æ–µ ‚Äî –∫–∞–∫ **–ª–∂–µ—Ü–∞**. –£ —Ç–µ–±—è –µ—Å—Ç—å **–Ω–µ—Å–∫–æ–ª—å–∫–æ —Å–≤–∏–¥–µ—Ç–µ–ª–µ–π** (–º–∞–ª–µ–Ω—å–∫–∏–µ —á–∏—Å–ª–∞ 2, 3, 7...), –∫–æ—Ç–æ—Ä—ã–µ –∑–∞–¥–∞—é—Ç —Å—É–¥—å–µ **—Å–ª–æ–∂–Ω—ã–µ –≤–æ–ø—Ä–æ—Å—ã**.

**–ü—Ä–∞–≤–∏–ª–æ –∏–≥—Ä—ã:** –ï—Å–ª–∏ —Å—É–¥—å—è —á–µ—Å—Ç–Ω—ã–π (—á–∏—Å–ª–æ –ø—Ä–æ—Å—Ç–æ–µ), –æ–Ω –≤—Å–µ–≥–¥–∞ –æ—Ç–≤–µ—á–∞–µ—Ç –ø—Ä–∞–≤–∏–ª—å–Ω–æ. –ï—Å–ª–∏ –ª–∂–µ—Ü (—Å–æ—Å—Ç–∞–≤–Ω–æ–µ), —Ç–æ —Å –≤—ã—Å–æ–∫–æ–π –≤–µ—Ä–æ—è—Ç–Ω–æ—Å—Ç—å—é **—Ö–æ—Ç—è –±—ã –æ–¥–∏–Ω —Å–≤–∏–¥–µ—Ç–µ–ª—å** –ø–æ–π–º–∞–µ—Ç –µ–≥–æ –Ω–∞ –ª–∂–∏.

Miller-Rabin ‚Äî —ç—Ç–æ **–º–∞—Ç–µ–º–∞—Ç–∏—á–µ—Å–∫–∏–π –¥–æ–ø—Ä–æ—Å**: –º—ã –∑–∞—Å—Ç–∞–≤–ª—è–µ–º —á–∏—Å–ª–æ –¥–æ–∫–∞–∑–∞—Ç—å —Å–≤–æ—é —á–µ—Å—Ç–Ω–æ—Å—Ç—å, –≤—ã—á–∏—Å–ª—è—è —Å–ª–æ–∂–Ω—ã–µ —Å—Ç–µ–ø–µ–Ω–∏ –ø–æ –º–æ–¥—É–ª—é.

## –®–∞–≥ 1: nth(n) ‚Äî –ü—Ä–æ—Å—Ç–æ–π –ø–µ—Ä–µ–±–æ—Ä —Å MR-—Ç–µ—Å—Ç–æ–º

```rust
pub fn nth(n: u32) -> u32 {
    let mut num = 1;  // –Ω–∞—á–∏–Ω–∞–µ–º —Å 2 (1-–µ –ø—Ä–æ—Å—Ç–æ–µ)
    for _ in 0..=n {  // –∏—â–µ–º n+1 –ø—Ä–æ—Å—Ç–æ–µ —á–∏—Å–ª–æ
        loop {
            num += 1;
            if miller_rabin(num as u64) { break; }  // MR –≥–æ–≤–æ—Ä–∏—Ç "–ø—Ä–æ—Å—Ç–æ–µ!"
        }
    }
    num
}
```

**–õ–æ–≥–∏–∫–∞:** "–•–æ–¥–∏ –ø–æ —á–∏—Å–ª–∞–º, –ø–æ–∫–∞ –Ω–µ –Ω–∞–π–¥–µ—à—å n –ø—Ä–æ—Å—Ç—ã—Ö". –ú–µ–¥–ª–µ–Ω–Ω–æ (O(n log n)), –Ω–æ **–∫–æ—Ä—Ä–µ–∫—Ç–Ω–æ**. –î–ª—è Exercism (n –¥–æ 10k) —Ä–∞–±–æ—Ç–∞–µ—Ç –º–≥–Ω–æ–≤–µ–Ω–Ω–æ.

## –®–∞–≥ 2: –ü–æ–¥–≥–æ—Ç–æ–≤–∫–∞ MR-—Ç–µ—Å—Ç–∞ (d –∏ s)

```rust
let mut d = n - 1;
let mut s = 0;
while d % 2 == 0 { d /= 2; s += 1 }
```

**–ú–∞—Ç–µ–º–∞—Ç–∏–∫–∞:** –ö–∞–∂–¥–æ–µ –ø—Ä–æ—Å—Ç–æ–µ —É–¥–æ–≤–ª–µ—Ç–≤–æ—Ä—è–µ—Ç **–º–∞–ª–æ–π —Ç–µ–æ—Ä–µ–º–µ –§–µ—Ä–º–∞**: \(a^{n-1} \equiv 1 \pmod n\).

–ù–æ –≤–º–µ—Å—Ç–æ –ø—Ä—è–º–æ–≥–æ –≤—ã—á–∏—Å–ª–µ–Ω–∏—è \(a^{n-1}\) –º—ã —Ä–∞—Å–∫–ª–∞–¥—ã–≤–∞–µ–º –ø–æ–∫–∞–∑–∞—Ç–µ–ª—å:
\[ n-1 = d \cdot 2^s \]
–≥–¥–µ \(d\) ‚Äî –Ω–µ—á–µ—Ç–Ω–æ–µ. **–ü–æ—á–µ–º—É?** –ß—Ç–æ–±—ã –ø—Ä–æ–≤–µ—Ä—è—Ç—å –ø—Ä–æ–º–µ–∂—É—Ç–æ—á–Ω—ã–µ –∫–≤–∞–¥—Ä–∞—Ç—ã.

**–ú–µ—Ç–∞—Ñ–æ—Ä–∞:** "–ù–µ —Å–ø—Ä–∞—à–∏–≤–∞–π —Å—Ä–∞–∑—É '—Ç—ã —á–µ—Å—Ç–Ω—ã–π?', –∞ —Å–Ω–∞—á–∞–ª–∞ –ø—Ä–æ–≤–µ—Ä—å –±–∞–∑–æ–≤–æ–µ —Å–≤–æ–π—Å—Ç–≤–æ, –ø–æ—Ç–æ–º –≤–æ–∑–≤–æ–¥–∏ –≤ –∫–≤–∞–¥—Ä–∞—Ç —à–∞–≥ –∑–∞ —à–∞–≥–æ–º".

## –®–∞–≥ 3: Witness Table (—Ñ—É–Ω–∫—Ü–∏–æ–Ω–∞–ª—å–Ω—ã–π —Å—Ç–∏–ª—å)

```rust
let witnesses = WITNESSES.iter()
    .find(|&&(hi, _)| hi >= n)  // –∏—â–µ–º –Ω—É–∂–Ω—ã–π –¥–∏–∞–ø–∞–∑–æ–Ω
    .map(|&(_, wtnss)| wtnss)   // –∏–∑–≤–ª–µ–∫–∞–µ–º —Å–ø–∏—Å–æ–∫ —Å–≤–∏–¥–µ—Ç–µ–ª–µ–π
    .unwrap();
```

**–ì–µ–Ω–∏–∞–ª—å–Ω–æ—Å—Ç—å:** –î–ª—è –∫–∞–∂–¥–æ–≥–æ –¥–∏–∞–ø–∞–∑–æ–Ω–∞ –∏–∑–≤–µ—Å—Ç–µ–Ω **–º–∏–Ω–∏–º–∞–ª—å–Ω—ã–π –Ω–∞–±–æ—Ä —Å–≤–∏–¥–µ—Ç–µ–ª–µ–π**, –≥–∞—Ä–∞–Ω—Ç–∏—Ä—É—é—â–∏–π 100% —Ç–æ—á–Ω–æ—Å—Ç—å.

| –î–∏–∞–ø–∞–∑–æ–Ω   | –°–≤–∏–¥–µ—Ç–µ–ª–∏             | –¢–µ—Å—Ç–æ–≤ |
| ---------- | --------------------- | ------ |
| < 2047     |                       | 1      |
| < 4.7e9    | [1]                   | 3      |
| < u64::MAX | [7][1][2][3][4][5][6] | 12     |

**–§—É–Ω–∫—Ü–∏–æ–Ω–∞–ª—å–Ω—ã–π —Å—Ç–∏–ª—å:** `iter().find().map()` ‚Äî —á–∏—Å—Ç—ã–π, –±–µ–∑ –º—É—Ç–∞–±–µ–ª—å–Ω–æ—Å—Ç–∏, –ª–µ–≥–∫–æ —Ç–µ—Å—Ç–∏—Ä–æ–≤–∞—Ç—å.

## –®–∞–≥ 4: –û—Å–Ω–æ–≤–Ω–æ–π —Ü–∏–∫–ª MR (—Å–µ—Ä–¥—Ü–µ –∞–ª–≥–æ—Ä–∏—Ç–º–∞)

```rust
for &a in witnesses.iter() {  // –¥–ª—è –∫–∞–∂–¥–æ–≥–æ —Å–≤–∏–¥–µ—Ç–µ–ª—è
    let mut power = mod_exp(a, d, n);  // x0 = a^d mod n
    
    if power == 1 || power == n-1 { continue }  // —Ç–µ—Å—Ç –ø—Ä–æ–π–¥–µ–Ω
    
    for _r in 0..s {  // s —Ä–∞–∑ –≤–æ–∑–≤–æ–¥–∏–º –≤ –∫–≤–∞–¥—Ä–∞—Ç
        power = mod_sqr(power, n);            // xr+1 = xr^2 mod n
        if power == n-1 { continue 'next_witness }  // —Ç–µ—Å—Ç –ø—Ä–æ–π–¥–µ–Ω!
        if power == 1 { return false }        // —Å–æ—Å—Ç–∞–≤–Ω–æ–µ!
    }
    return false;  // –≤—Å–µ —Å–≤–∏–¥–µ—Ç–µ–ª–∏ –ø–æ–π–º–∞–ª–∏ –Ω–∞ –ª–∂–∏
}
```

**–õ–æ–≥–∏–∫–∞ —Ç–µ—Å—Ç–∞:**
1. –í—ã—á–∏—Å–ª—è–µ–º \(x_0 = a^d \mod n\)
2. –ï—Å–ª–∏ \(x_0 = 1\) –∏–ª–∏ \(x_0 = n-1\) ‚Üí —Å–≤–∏–¥–µ—Ç–µ–ª—å –¥–æ–≤–æ–ª–µ–Ω
3. –ò–Ω–∞—á–µ –¥–µ–ª–∞–µ–º \(s\) –∫–≤–∞–¥—Ä–∞—Ç–æ–≤: \(x_{r+1} = x_r^2 \mod n\)
4. –ï—Å–ª–∏ —Ö–æ—Ç—å —Ä–∞–∑ –ø–æ–ª—É—á–∏–ª–∏ \(n-1\) ‚Üí —Å–≤–∏–¥–µ—Ç–µ–ª—å –¥–æ–≤–æ–ª–µ–Ω
5. –ï—Å–ª–∏ –¥–æ—à–ª–∏ –¥–æ –∫–æ–Ω—Ü–∞ ‚Üí **–ª–∂–µ—Ü –ø–æ–π–º–∞–Ω!**

## –®–∞–≥ 5: –ë—ã—Å—Ç—Ä–æ–µ –≤–æ–∑–≤–µ–¥–µ–Ω–∏–µ –≤ —Å—Ç–µ–ø–µ–Ω—å (Binary Exponentiation)

```rust
fn mod_exp(mut x: u64, mut d: u64, n: u64) -> u64 {
    let mut ret: u64 = 1;
    while d != 0 {
        if d % 2 == 1 {  // –µ—Å–ª–∏ –±–∏—Ç —Å—Ç–µ–ø–µ–Ω–∏ = 1
            ret = mod_mul(ret, x, n);  // ret *= x
        }
        d /= 2;                // —Å–¥–≤–∏–≥ —Å—Ç–µ–ø–µ–Ω–∏
        x = mod_sqr(x, n);     // x = x^2 (–¥–ª—è —Å–ª–µ–¥—É—é—â–µ–≥–æ –±–∏—Ç–∞)
    }
    ret
}
```

**–ú–µ—Ç–∞—Ñ–æ—Ä–∞:** "–ù–µ —É–º–Ω–æ–∂–∞–π 2^1000 = 2√ó2√ó2... 1000 —Ä–∞–∑. –ò—Å–ø–æ–ª—å–∑—É–π (2^2)^2 = 2^4, ((2^4)^2)^2 = 2^16 –∏ —Ç.–¥."

O(log d) —É–º–Ω–æ–∂–µ–Ω–∏–π –≤–º–µ—Å—Ç–æ O(d).

## –®–∞–≥ 6: –ë–µ–∑–æ–ø–∞—Å–Ω–æ–µ —É–º–Ω–æ–∂–µ–Ω–∏–µ –ø–æ –º–æ–¥—É–ª—é (u64 ‚Üí u128)

```rust
fn mod_mul(a: u64, b: u64, m: u64) -> u64 {
    match a.checked_mul(b) {
        Some(r) => if r >= m { r % m } else { r },
        None => mod_mul_(a, b, m),  // fallback –Ω–∞ u128
    }
}
```

**–ü—Ä–æ–±–ª–µ–º–∞:** \(2^{64}-1 \times 2^{64}-1 = 2^{128}\), –ø–µ—Ä–µ–ø–æ–ª–Ω–µ–Ω–∏–µ!
**–†–µ—à–µ–Ω–∏–µ:** `checked_mul` + fallback –Ω–∞ `u128::from(a) * u128::from(b) % u128::from(m)`.

**–û–ø—Ç–∏–º–∏–∑–∞—Ü–∏—è `mod_sqr`:** –î–ª—è \(a < 2^{32}\) –æ–±—ã—á–Ω–æ–µ `a*a` –±—ã—Å—Ç—Ä–µ–µ `u128`.

## –ò—Ç–æ–≥: –ü–æ—á–µ–º—É –∫–æ–¥ Production-Ready

```
‚úÖ –î–µ—Ç–µ—Ä–º–∏–Ω–∏—Ä–æ–≤–∞–Ω–Ω—ã–π (–Ω–µ –≤–µ—Ä–æ—è—Ç–Ω–æ—Å—Ç–Ω—ã–π)
‚úÖ O(‚àön) –Ω–∞ —Å–≤–∏–¥–µ—Ç–µ–ª—å (—Å log n –Ω–∞ mod_exp)
‚úÖ –ë–µ–∑–æ–ø–∞—Å–µ–Ω –æ—Ç overflow (u128 fallback)
‚úÖ –§—É–Ω–∫—Ü–∏–æ–Ω–∞–ª—å–Ω—ã–π —Å—Ç–∏–ª—å (–∏–º–º—É—Ç–∞–±–µ–ª—å–Ω—ã–µ –∏—Ç–µ—Ä–∞—Ç–æ—Ä—ã)
‚úÖ –¢–∞–±–ª–∏—Ü–∞ —Å–≤–∏–¥–µ—Ç–µ–ª–µ–π –ø–æ–∫—Ä—ã–≤–∞–µ—Ç –≤–µ—Å—å u64
‚úÖ –ú–∏–∫—Ä–æ–æ–ø—Ç–∏–º–∏–∑–∞—Ü–∏–∏ (mod_sqr –¥–ª—è –º–∞–ª—ã—Ö —á–∏—Å–µ–ª)
```

**–ö–æ–≥–¥–∞ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å:** –ü—Ä–æ–≤–µ—Ä–∫–∞ **–∫–æ–Ω–∫—Ä–µ—Ç–Ω—ã—Ö** –±–æ–ª—å—à–∏—Ö —á–∏—Å–µ–ª (10^18 + 7?).  
**–ö–æ–≥–¥–∞ –ù–ï –∏—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å:** –ì–µ–Ω–µ—Ä–∞—Ü–∏—è –ø–æ—Å–ª–µ–¥–æ–≤–∞—Ç–µ–ª—å–Ω–æ—Å—Ç–∏ –ø—Ä–æ—Å—Ç—ã—Ö ‚Äî —Ç—É—Ç sieve –≤ 1000x –±—ã—Å—Ç—Ä–µ–µ.

–≠—Ç–æ—Ç –∫–æ–¥ ‚Äî **–∑–æ–ª–æ—Ç–æ–π —Å—Ç–∞–Ω–¥–∞—Ä—Ç** –¥–ª—è –∫—Ä–∏–ø—Ç–æ–≥—Ä–∞—Ñ–∏–∏ –∏ —Å–∏—Å—Ç–µ–º–Ω–æ–≥–æ –ø—Ä–æ–≥—Ä–∞–º–º–∏—Ä–æ–≤–∞–Ω–∏—è.[4]

[1](https://github.com/SergioBenitez/Rocket/issues/1522)
[2](https://gliderkite.github.io/posts/sr-cache/)
[3](https://stackoverflow.com/questions/16761898/redis-as-write-back-view-count-cache-for-mysql)
[4](https://github.com/jedisct1/rust-sieve-cache)
[5](https://dev.to/artslob/32-rust-crates-you-better-know-about-4aa7)
[6](https://lib.rs/crates/staticvec)
[7](https://www.perplexity.ai/search/444a1554-6943-4987-9a27-5923865aea84)


## –ú–∞–ª–∞—è —Ç–µ–æ—Ä–µ–º–∞ –§–µ—Ä–º–∞ (—à–∞–≥ 2 MR)

**–§–æ—Ä–º—É–ª–∏—Ä–æ–≤–∫–∞:**  
–ï—Å–ª–∏ \( p \) ‚Äî –ø—Ä–æ—Å—Ç–æ–µ —á–∏—Å–ª–æ –∏ \( a \) –Ω–µ –¥–µ–ª–∏—Ç—Å—è –Ω–∞ \( p \), —Ç–æ:  
\[ a^{p-1} \equiv 1 \pmod{p} \]  
–∏–ª–∏ —ç–∫–≤–∏–≤–∞–ª–µ–Ω—Ç–Ω–æ:  
\[ a^p \equiv a \pmod{p} \] [1]

### –ú–µ—Ç–∞—Ñ–æ—Ä–∞ "–ö–æ–ª—å—Ü–æ —á–∞—Å–æ–≤"

–ü—Ä–µ–¥—Å—Ç–∞–≤—å \( p = 5 \) –ø—Ä–æ—Å—Ç–æ–µ —á–∏—Å–ª–æ –∫–∞–∫ **—Ü–∏—Ñ–µ—Ä–±–ª–∞—Ç —Å 5 –¥–µ–ª–µ–Ω–∏—è–º–∏** (0,1,2,3,4). –£–º–Ω–æ–∂–µ–Ω–∏–µ –Ω–∞ \( a = 3 \) ‚Äî —ç—Ç–æ **–ø–æ–≤–æ—Ä–æ—Ç —Å—Ç—Ä–µ–ª–∫–∏**:

```
–°—Ç—Ä–µ–ª–∫–∞ –Ω–∞ 1 ‚Üí √ó3 = 3
–°—Ç—Ä–µ–ª–∫–∞ –Ω–∞ 2 ‚Üí √ó3 = 6 ‚â° 1 (mod 5)  
–°—Ç—Ä–µ–ª–∫–∞ –Ω–∞ 3 ‚Üí √ó3 = 9 ‚â° 4 (mod 5)
–°—Ç—Ä–µ–ª–∫–∞ –Ω–∞ 4 ‚Üí √ó3 = 12 ‚â° 2 (mod 5)
```

**–í–∞–∂–Ω–æ:** –ü–æ–≤–æ—Ä–æ—Ç –Ω–∞ \( 1,2,3,4 \) –¥–∞–ª **–≤—Å–µ –≤–æ–∑–º–æ–∂–Ω—ã–µ –ø–æ–∑–∏—Ü–∏–∏** (1,3,4,2) ‚Äî **–ø–æ–ª–Ω—ã–π —Ü–∏–∫–ª**! –£–º–Ω–æ–∂–µ–Ω–∏–µ –Ω–∞ 3 **–ø—Ä–æ—Ö–æ–¥–∏—Ç—Å—è –ø–æ –≤—Å–µ–º—É –∫–æ–ª—å—Ü—É**.

**–¢–µ–æ—Ä–µ–º–∞ –≥–æ–≤–æ—Ä–∏—Ç:** –ï—Å–ª–∏ \( p \) –ø—Ä–æ—Å—Ç–æ–µ, —Ç–æ –ª—é–±–æ–µ \( a \) (–Ω–µ –∫—Ä–∞—Ç–Ω–æ–µ \( p \)) –∑–∞ \( p-1 \) –ø–æ–≤–æ—Ä—Ç–æ–≤ **–≤–µ—Ä–Ω–µ—Ç—Å—è –≤ –∏—Å—Ö–æ–¥–Ω—É—é —Ç–æ—á–∫—É**.

### –ü—Ä–∏–º–µ—Ä –≤—ã—á–∏—Å–ª–µ–Ω–∏—è

```rust
// p = 13 (–ø—Ä–æ—Å—Ç–æ–µ), a = 5
5^12 mod 13 = ?  // –º–∞–ª–∞—è —Ç–µ–æ—Ä–µ–º–∞: –¥–æ–ª–∂–Ω–æ –±—ã—Ç—å 1

5^1 ‚â° 5
5^2 ‚â° 25 ‚â° 12 ‚â° -1  
5^4 ‚â° (-1)^2 ‚â° 1
5^8 ‚â° 1^2 ‚â° 1
5^12 = 5^8 √ó 5^4 ‚â° 1 √ó 1 ‚â° 1 ‚úì
```

### –ü–æ—á–µ–º—É —ç—Ç–æ —Ä–∞–±–æ—Ç–∞–µ—Ç (–¥–æ–∫–∞–∑–∞—Ç–µ–ª—å—Å—Ç–≤–æ —á–µ—Ä–µ–∑ –ø–µ—Ä–µ—Å—Ç–∞–Ω–æ–≤–∫–∏)

**–ö–ª—é—á–µ–≤–æ–π –∏–Ω—Å–∞–π—Ç:** –û—Å—Ç–∞—Ç–∫–∏ \( 1, 2, ..., p-1 \) –ø—Ä–∏ —É–º–Ω–æ–∂–µ–Ω–∏–∏ –Ω–∞ \( a \) –¥–∞—é—Ç **–ø–µ—Ä–µ—Å—Ç–∞–Ω–æ–≤–∫—É** —Ç–µ—Ö –∂–µ —á–∏—Å–µ–ª:

```rust
p = 7, a = 3
1√ó3 = 3
2√ó3 = 6  
3√ó3 = 9 ‚â° 2
4√ó3 = 12 ‚â° 5
5√ó3 = 15 ‚â° 1
6√ó3 = 18 ‚â° 4

–ü–æ–ª—É—á–∏–ª–∏: [3,6,2,5,1,4] ‚Äî –≤—Å–µ —á–∏—Å–ª–∞ 1..6 –≤ –¥—Ä—É–≥–æ–º –ø–æ—Ä—è–¥–∫–µ!
```

**–ü—Ä–æ–∏–∑–≤–µ–¥–µ–Ω–∏–µ –≤—Å–µ—Ö —ç–ª–µ–º–µ–Ω—Ç–æ–≤ –æ–¥–∏–Ω–∞–∫–æ–≤–æ:**
\[ 1 \times 2 \times \dots \times (p-1) = a \times 2a \times \dots \times (p-1)a \pmod{p} \]
\[ (p-1)! \equiv a^{p-1} \times (p-1)! \pmod{p} \]
–°–æ–∫—Ä–∞—â–∞–µ–º \( (p-1)! \) (–æ–Ω–æ –Ω–µ 0 mod p):
\[ 1 \equiv a^{p-1} \pmod{p} \]

### –ü–æ—á–µ–º—É MR –∏—Å–ø–æ–ª—å–∑—É–µ—Ç –∏–º–µ–Ω–Ω–æ —ç—Ç—É —Ç–µ–æ—Ä–µ–º—É

**–ü—Ä—è–º–∞—è –ø—Ä–æ–≤–µ—Ä–∫–∞ \( a^{p-1} \mod p \) –Ω–µ—ç—Ñ—Ñ–µ–∫—Ç–∏–≤–Ω–∞** ‚Äî –ø–æ–∫–∞–∑–∞—Ç–µ–ª—å —Å—Ç–µ–ø–µ–Ω–∏ –æ–≥—Ä–æ–º–Ω—ã–π (–¥–æ \( 2^{64} \)).

**–•–∏—Ç—Ä–æ—Å—Ç—å MR:** –í–º–µ—Å—Ç–æ \( a^{p-1} \) –ø—Ä–æ–≤–µ—Ä—è–µ–º **–ø—Ä–æ–º–µ–∂—É—Ç–æ—á–Ω—ã–µ –∫–≤–∞–¥—Ä–∞—Ç—ã**:
\[ n-1 = d \times 2^s \]
\[ a^{n-1} = (a^d)^{2^s} \]

–ï—Å–ª–∏ \( a^d \equiv 1 \) –∏–ª–∏ —Ö–æ—Ç—è –±—ã –æ–¥–∏–Ω –∫–≤–∞–¥—Ä–∞—Ç –¥–∞–µ—Ç \( n-1 \), —Ç–æ –ø–æ —Å–≤–æ–π—Å—Ç–≤–∞–º —Å—Ç–µ–ø–µ–Ω–µ–π —Ç–µ–æ—Ä–µ–º–∞ –≤—ã–ø–æ–ª–Ω—è–µ—Ç—Å—è.

**–ú–µ—Ç–∞—Ñ–æ—Ä–∞:** –í–º–µ—Å—Ç–æ "—Å–¥–µ–ª–∞–π 1 —Ç—Ä–ª–Ω –ø–æ–≤–æ—Ä—Ç–æ–≤ —Å—Ç—Ä–µ–ª–∫–∏" –≥–æ–≤–æ—Ä–∏–º "—Å–¥–µ–ª–∞–π 40 –ø–æ–≤–æ—Ä—Ç–æ–≤, –Ω–æ –ø—Ä–æ–≤–µ—Ä—è–π –ø—Ä–æ–º–µ–∂—É—Ç–æ—á–Ω—ã–µ –ø–æ–∑–∏—Ü–∏–∏".

### –ü—Ä–æ–≤–µ—Ä–∫–∞ –Ω–∞ –ø—Ä–∞–∫—Ç–∏–∫–µ

```rust
fn fermat_test(n: u64, a: u64) -> bool {
    mod_exp(a, n-1, n) == 1  // –ø—Ä—è–º–∞—è –º–∞–ª–∞—è —Ç–µ–æ—Ä–µ–º–∞
}

// –ù–æ! 561 ‚Äî –ø—Å–µ–≤–¥–æ–ø—Ä–æ—Å—Ç–æ–µ –ø–æ –æ—Å–Ω–æ–≤–∞–Ω–∏—é 2:
// 2^560 ‚â° 1 mod 561, —Ö–æ—Ç—è 561 = 3√ó11√ó17
```

**–í—ã–≤–æ–¥:** –ú–∞–ª–∞—è —Ç–µ–æ—Ä–µ–º–∞ ‚Äî **–Ω–µ–æ–±—Ö–æ–¥–∏–º–æ–µ** —É—Å–ª–æ–≤–∏–µ –ø—Ä–æ—Å—Ç–æ—Ç—ã, –Ω–æ **–Ω–µ–¥–æ—Å—Ç–∞—Ç–æ—á–Ω–æ–µ** (–µ—Å—Ç—å "–ª–∂–µ—Ü—ã"). MR —É—Å–∏–ª–∏–≤–∞–µ—Ç —Ç–µ—Å—Ç **—Å—Ç—Ä—É–∫—Ç—É—Ä–∏—Ä–æ–≤–∞–Ω–Ω—ã–º–∏ –ø—Ä–æ–º–µ–∂—É—Ç–æ—á–Ω—ã–º–∏ –ø—Ä–æ–≤–µ—Ä–∫–∞–º–∏** + **–Ω–µ—Å–∫–æ–ª—å–∫–∏–º–∏ –æ—Å–Ω–æ–≤–∞–Ω–∏—è–º–∏**.

–¢–µ–ø–µ—Ä—å –ø–æ–Ω—è—Ç–µ–Ω —à–∞–≥ 2? –ò–¥–µ–º –∫ witness table? üöÄ

[1](https://ru.wikipedia.org/wiki/%D0%9C%D0%B0%D0%BB%D0%B0%D1%8F_%D1%82%D0%B5%D0%BE%D1%80%D0%B5%D0%BC%D0%B0_%D0%A4%D0%B5%D1%80%D0%BC%D0%B0)
[2](https://math.mosolymp.ru/upload/files/2022/other/1568/8-1/Malaya_teorema_Ferma.pdf)
[3](https://foxford.ru/wiki/matematika/malaya-teorema-ferma)
[4](https://www.lirmm.fr/~ashen/mathclass/09fermat-prob.pdf)
[5](https://wiki.algocode.ru/index.php?title=%D0%9C%D0%B0%D0%BB%D0%B0%D1%8F_%D1%82%D0%B5%D0%BE%D1%80%D0%B5%D0%BC%D0%B0_%D0%A4%D0%B5%D1%80%D0%BC%D0%B0)
[6](https://kvant.mccme.ru/pdf/2000/04/kv0400ferm.pdf)
[7](https://ru.wikipedia.org/wiki/%D0%A2%D0%B5%D0%BE%D1%80%D0%B5%D0%BC%D0%B0_%D0%A4%D0%B5%D1%80%D0%BC%D0%B0_%E2%80%94_%D0%AD%D0%B9%D0%BB%D0%B5%D1%80%D0%B0)
[8](https://journalpro.ru/articles/malaya-teorema-ferma-i-ee-primenenie-v-kriptosistemakh/)
[9](https://www.reddit.com/r/math/comments/2v6db7/intuition_for_fermats_little_theorem/)
[10](https://math.fandom.com/ru/wiki/%D0%9C%D0%B0%D0%BB%D0%B0%D1%8F_%D1%82%D0%B5%D0%BE%D1%80%D0%B5%D0%BC%D0%B0_%D0%A4%D0%B5%D1%80%D0%BC%D0%B0)
